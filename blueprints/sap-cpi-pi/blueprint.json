{
  "metadata": {
    "blueprintId": "sap-cpi-pi",
    "blueprintName": "SAP CPI/PI Integration Blueprint",
    "description": "SAP Cloud Platform Integration and Process Integration development with Groovy scripts, Java adapters, and iFlow patterns",
    "version": "2.0.0",
    "author": "Cursor Agent Factory",
    "tags": ["sap", "cpi", "pi", "integration", "groovy", "java", "iflow", "b2b", "edi"],
    "purpose": "Enable SAP integration developers to build robust iFlows with proper patterns, error handling, and testing"
  },
  "stack": {
    "primaryLanguage": "groovy",
    "groovyVersion": "4.0.x",
    "secondaryLanguage": "java",
    "frameworks": [
      {"name": "SAP CPI Groovy SDK", "version": "1.x", "purpose": "Cloud Platform Integration scripting"},
      {"name": "SAP PI Adapter Framework", "version": "7.5+", "purpose": "On-premise adapter development"},
      {"name": "Apache Camel", "version": "underlying", "purpose": "Integration framework (CPI foundation)"},
      {"name": "Spock Framework", "version": "2.4+", "purpose": "Groovy testing framework"}
    ],
    "platforms": [
      {"name": "SAP Integration Suite", "type": "cloud", "purpose": "Cloud-based integration"},
      {"name": "SAP CPI", "type": "cloud", "purpose": "Cloud Platform Integration"},
      {"name": "SAP PI/PO", "type": "on-premise", "purpose": "Process Integration/Orchestration"}
    ],
    "protocols": [
      {"name": "REST/OData", "purpose": "API-based integrations"},
      {"name": "SOAP", "purpose": "Web services"},
      {"name": "IDoc", "purpose": "SAP native document exchange"},
      {"name": "SFTP/AS2", "purpose": "B2B file transfer"},
      {"name": "EDIFACT/X12", "purpose": "EDI standards"},
      {"name": "AMQP/Kafka", "purpose": "Event-driven messaging"}
    ],
    "tools": [
      {"name": "Eclipse", "purpose": "PI development (NWDS)"},
      {"name": "IntelliJ IDEA", "purpose": "Groovy/Java development"},
      {"name": "SAP CPI Web IDE", "purpose": "Cloud iFlow development"},
      {"name": "Postman", "purpose": "API testing"},
      {"name": "SoapUI", "purpose": "SOAP service testing"},
      {"name": "Spock Framework", "purpose": "Groovy unit testing"}
    ],
    "styleGuides": [
      {"name": "groovy-style", "description": "Groovy Style Guide", "reference": "https://groovy-lang.org/style-guide.html"},
      {"name": "sap-cpi-guidelines", "description": "SAP CPI Best Practices", "reference": "https://help.sap.com/docs/cloud-integration"}
    ]
  },
  "agents": [
    {"patternId": "code-reviewer", "required": true, "customizations": {"skills": ["groovy-scripting", "grounding"], "focus": "CPI patterns, error handling, performance"}},
    {"patternId": "test-generator", "required": true, "customizations": {"skills": ["tdd"], "focus": "Groovy script tests, mock message testing"}},
    {"patternId": "documentation-agent", "required": false, "customizations": {"focus": "iFlow documentation, mapping specs"}}
  ],
  "skills": [
    {"patternId": "iflow-development", "required": true, "description": "Complete iFlow creation workflow"},
    {"patternId": "groovy-scripting", "required": true, "description": "Groovy script development with CPI patterns"},
    {"patternId": "error-handling", "required": true, "description": "Exception handling and alerting"},
    {"patternId": "b2b-integration", "required": false, "description": "B2B/EDI specific workflows"},
    {"patternId": "grounding", "required": true, "description": "Verify against SAP documentation"},
    {"patternId": "tdd", "required": true, "description": "Test-driven script development"},
    {"patternId": "bugfix-workflow", "required": true},
    {"patternId": "feature-workflow", "required": true}
  ],
  "knowledge": [
    {"filename": "groovy-patterns.json", "description": "Groovy scripting best practices for CPI (Groovy 4.x compatible)", "required": true},
    {"filename": "iflow-patterns.json", "description": "Integration flow design patterns and architecture", "required": true},
    {"filename": "sap-cap-patterns.json", "description": "SAP CAP patterns for integration scenarios and API development", "required": false},
    {"filename": "cpi-error-handling.json", "description": "Exception handling and alerting patterns"},
    {"filename": "mapping-patterns.json", "description": "Message mapping techniques"},
    {"filename": "b2b-patterns.json", "description": "EDI, IDoc, partner management patterns"},
    {"filename": "security-patterns.json", "description": "OAuth, certificates, credential management"}
  ],
  "templates": {
    "codeTemplates": [
      {"category": "groovy-script", "directory": "templates/integration/groovy/", "version": "4.x"},
      {"category": "groovy-base", "directory": "templates/integration/groovy/", "description": "Base Groovy script templates"},
      {"category": "groovy-message-processing", "directory": "templates/integration/groovy/message-processing/", "description": "XML, JSON, logging, credential access patterns"},
      {"category": "groovy-error-handling", "directory": "templates/integration/groovy/error-handling/", "description": "Exception handling, retry, circuit breaker patterns"},
      {"category": "b2b-integration", "directory": "templates/integration/b2b/", "description": "IDoc, EDI, AS2, partner management patterns"},
      {"category": "test-script", "directory": "templates/integration/test/", "framework": "Spock"},
      {"category": "iflow-patterns", "directory": "templates/integration/iflow/", "description": "Exception subprocess, content router, splitter patterns"}
    ],
    "documentTemplates": [
      {"name": "iflow-spec.md.tmpl", "directory": "templates/docs/integration/", "description": "Integration flow specification template"},
      {"name": "mapping-spec.md.tmpl", "directory": "templates/docs/integration/", "description": "Message mapping specification"}
    ]
  },
  "workflows": [
    {"patternId": "iflow-development", "customizations": {}},
    {"patternId": "jira-bugfix", "customizations": {}},
    {"patternId": "confluence-feature", "customizations": {}}
  ],
  "mcpServers": [
    {"name": "sap-documentation", "url": "https://mcp-sap-docs.marianzeis.de/mcp", "purpose": "SAP Help Portal, CPI/PI documentation, Groovy patterns, iFlow best practices", "required": true},
    {"name": "atlassian", "url": "https://mcp.atlassian.com/v1/sse", "purpose": "Jira/Confluence integration for requirements and documentation", "required": false},
    {"name": "deepwiki", "url": "https://mcp.deepwiki.com/mcp", "purpose": "SAP sample repositories and integration examples", "required": false}
  ],
  "projectStructure": {
    "directories": [
      {"path": ".cursor/agents/", "purpose": "AI agent definitions"},
      {"path": ".cursor/skills/", "purpose": "Reusable skills"},
      {"path": "knowledge/", "purpose": "Reference patterns"},
      {"path": "src/main/groovy/scripts/", "purpose": "Groovy scripts"},
      {"path": "src/main/groovy/mappings/", "purpose": "Message mappings"},
      {"path": "src/main/java/adapters/", "purpose": "Custom Java adapters"},
      {"path": "src/main/resources/", "purpose": "Configuration files"},
      {"path": "src/test/groovy/", "purpose": "Groovy tests (Spock)"},
      {"path": "iflows/", "purpose": "iFlow definitions"},
      {"path": "docs/", "purpose": "Interface documentation"},
      {"path": "workflows/", "purpose": "Methodology configuration"}
    ],
    "files": [
      {"path": ".cursorrules", "purpose": "Agent behavior rules"},
      {"path": "PURPOSE.md", "purpose": "Purpose document"},
      {"path": "README.md", "purpose": "Project documentation"},
      {"path": "build.gradle", "purpose": "Gradle build for testing"}
    ]
  },
  "enforcement": [
    {"patternId": "groovy-style-enforcement", "required": true, "description": "Enforce Groovy style guide compliance"},
    {"patternId": "iflow-pattern-compliance", "required": true, "description": "Ensure iFlow patterns are followed"},
    {"patternId": "error-handling-enforcement", "required": true, "description": "Require proper error handling"},
    {"patternId": "security-enforcement", "required": true, "description": "Enforce security best practices"}
  ],
  "testing": {
    "frameworks": [
      {"name": "Spock Framework", "version": "2.4+", "purpose": "Groovy unit testing", "required": true},
      {"name": "Mockito", "purpose": "Mocking for Java adapters", "required": false}
    ],
    "patterns": [
      {"name": "Given-When-Then", "description": "Structure test methods using Spock blocks"},
      {"name": "Mock Message Objects", "description": "Mock CPI message objects for testing"},
      {"name": "Test Isolation", "description": "Each test should be independent"},
      {"name": "Integration Tests", "description": "Test complete iFlow scenarios"}
    ]
  },
  "deployment": {
    "patterns": [
      {"name": "CPI Deployment", "description": "Deploy iFlows to SAP Integration Suite"},
      {"name": "PI Transport", "description": "Use SAP Transport Management for PI/PO"},
      {"name": "Version Control", "description": "Track iFlow versions and changes"},
      {"name": "CI/CD Integration", "description": "Automated testing and deployment"}
    ],
    "tools": [
      {"name": "SAP Integration Suite", "purpose": "Cloud-based integration platform"},
      {"name": "SAP Transport Management", "purpose": "On-premise transport management"},
      {"name": "Git", "purpose": "Version control for Groovy scripts and iFlow definitions"}
    ]
  },
  "cursorrules": {
    "variables": [
      {"name": "CPI_TENANT", "description": "CPI tenant URL", "default": ""},
      {"name": "STYLE_GUIDE", "description": "Coding style", "default": "groovy-style"},
      {"name": "LOG_LEVEL", "description": "Default log level", "default": "INFO"},
      {"name": "GROOVY_VERSION", "description": "Groovy version", "default": "4.0.x"},
      {"name": "SPOCK_VERSION", "description": "Spock Framework version", "default": "2.4+"}
    ],
    "rules": [
      {"name": "Groovy 4.x Features", "description": "Use Groovy 4.x features like sealed classes, switch expressions, and improved null safety. Check compatibility with CPI runtime."},
      {"name": "Null Safety", "description": "Use Groovy safe navigation (?.) and elvis operator (?:) for null handling. Prefer Groovy 4.x null-safe operators."},
      {"name": "Logging", "description": "Use messageLog for CPI logging, never System.out.println. Include context information in log messages."},
      {"name": "Error Handling", "description": "Always use try-catch with proper exception routing. Set error properties and route to exception subprocess."},
      {"name": "Properties", "description": "Use message properties/headers, not hardcoded values. Document all custom properties."},
      {"name": "Closures", "description": "Use closures for collection operations. Leverage Groovy 4.x closure improvements."},
      {"name": "Testing", "description": "Write Spock tests for all scripts. Use Given-When-Then blocks. Mock message objects."},
      {"name": "Security", "description": "Never hardcode credentials, use Secure Parameters. Encrypt sensitive data."},
      {"name": "iFlow Patterns", "description": "Follow iFlow design patterns: use exception subprocesses, implement retry logic, configure proper timeouts."},
      {"name": "MCP Integration", "description": "Use SAP documentation MCP server for CPI/PI questions, Groovy patterns, and iFlow best practices."},
      {"name": "Message Processing", "description": "Handle large messages efficiently. Use streaming for large payloads. Validate message structure early."},
      {"name": "Performance", "description": "Optimize Groovy scripts for performance. Avoid unnecessary iterations. Cache frequently accessed data."}
    ]
  },
  "groovyPatterns": {
    "messageAccess": {
      "description": "Accessing message body and properties",
      "example": "def body = message.getBody(String); def prop = message.getProperty('propName')"
    },
    "xmlParsing": {
      "description": "XML parsing with XmlSlurper",
      "example": "def xml = new XmlSlurper().parseText(body)"
    },
    "jsonParsing": {
      "description": "JSON parsing with JsonSlurper",
      "example": "def json = new JsonSlurper().parseText(body)"
    },
    "logging": {
      "description": "Proper CPI logging",
      "example": "def messageLog = messageLogFactory.getMessageLog(message); messageLog.addAttachmentAsString('Debug', body, 'text/plain')"
    },
    "errorHandling": {
      "description": "Exception handling pattern",
      "example": "try { /* logic */ } catch (Exception e) { message.setProperty('ErrorMessage', e.message); throw e }"
    }
  },
  "layerDefaults": {
    "layer0": {
      "coreAxioms": ["A1", "A2", "A3", "A4", "A5"],
      "optionalAxioms": ["A6", "A7"],
      "note": "A6 (Minimalism) keeps scripts focused. A7 (Reversibility) for transport management."
    },
    "layer1": {
      "purposeTemplate": "To build reliable SAP integrations with proper error handling, monitoring, and maintainability",
      "stakeholders": "Integration developers, SAP Basis team, business process owners"
    },
    "layer3": {
      "methodology": "kanban",
      "note": "Kanban suits interrupt-driven integration support work. Use Scrum for larger projects."
    }
  }
}
