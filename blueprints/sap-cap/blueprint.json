{
  "metadata": {
    "blueprintId": "sap-cap",
    "blueprintName": "SAP CAP Blueprint",
    "description": "SAP Cloud Application Programming Model (CAP) development with Node.js or Java, CDS, Fiori Elements, and BTP deployment",
    "version": "1.0.0",
    "author": "Cursor Agent Factory",
    "tags": ["sap", "cap", "cds", "nodejs", "java", "btp", "fiori", "odata", "hana", "cloud-foundry"],
    "purpose": "Enable CAP developers to build full-stack cloud applications with proper data modeling, service implementation, and BTP deployment"
  },
  "stack": {
    "primaryLanguage": "javascript",
    "secondaryLanguages": ["typescript", "cds", "java"],
    "frameworks": [
      {"name": "CAP", "version": "7.x", "purpose": "Cloud Application Programming Model framework"},
      {"name": "CDS", "version": "latest", "purpose": "Core Data Services for data modeling"},
      {"name": "Express.js", "version": "4.x", "purpose": "Underlying web framework (Node.js)"},
      {"name": "Fiori Elements", "version": "1.x", "purpose": "Annotation-driven UI generation"},
      {"name": "SAPUI5", "version": "1.x", "purpose": "SAP UI framework for custom UIs"}
    ],
    "databases": [
      {"name": "SAP HANA Cloud", "purpose": "Production database"},
      {"name": "SQLite", "purpose": "Local development database"}
    ],
    "tools": [
      {"name": "SAP Business Application Studio", "purpose": "Cloud-based development IDE"},
      {"name": "VS Code", "purpose": "Local development with CAP extensions"},
      {"name": "cds CLI", "purpose": "CAP command line tools"},
      {"name": "MTA Build Tool", "purpose": "Multi-target application packaging"},
      {"name": "Cloud Foundry CLI", "purpose": "BTP deployment"}
    ],
    "styleGuides": [
      {"name": "cap-best-practices", "description": "SAP CAP Best Practices", "reference": "https://cap.cloud.sap/docs/guides/best-practices"}
    ]
  },
  "agents": [
    {"patternId": "code-reviewer", "required": true, "customizations": {"name": "cap-code-reviewer", "skills": ["cap-patterns", "sap-grounding"], "focus": "CDS models, service handlers, OData annotations"}},
    {"patternId": "test-generator", "required": true, "customizations": {"name": "cap-test-generator", "skills": ["tdd-cap"], "focus": "Jest/Mocha tests for CAP services"}},
    {"patternId": "documentation-agent", "required": false, "customizations": {"name": "cap-doc-generator", "focus": "API documentation, CDS model docs"}},
    {"patternId": "explorer", "required": true, "customizations": {"name": "cap-explorer"}}
  ],
  "skills": [
    {"patternId": "cap-cds-modeling", "required": true, "description": "CDS entity and service modeling patterns"},
    {"patternId": "cap-service-handlers", "required": true, "description": "Service handler implementation patterns"},
    {"patternId": "cap-fiori-integration", "required": true, "description": "Fiori Elements annotation patterns"},
    {"patternId": "cap-deployment", "required": true, "description": "MTA deployment to BTP patterns"},
    {"patternId": "grounding", "required": true, "customizations": {"name": "sap-grounding"}},
    {"patternId": "tdd", "required": true, "customizations": {"name": "tdd-cap"}},
    {"patternId": "bugfix-workflow", "required": true},
    {"patternId": "feature-workflow", "required": true}
  ],
  "knowledge": [
    {"filename": "sap-cap-patterns.json", "description": "SAP CAP, CDS, and service patterns", "required": true},
    {"filename": "mapping-patterns.json", "description": "Data transformation patterns"},
    {"filename": "security-patterns.json", "description": "OAuth, XSUAA, authentication patterns"},
    {"filename": "sap-reference-repos.json", "description": "SAP CAP sample repositories"}
  ],
  "templates": {
    "cdsTemplates": [
      {"category": "entity", "directory": "templates/cap/nodejs/db/", "description": "CDS entity definition"},
      {"category": "entity-associations", "directory": "templates/cap/nodejs/db/", "description": "Entity with associations and compositions"},
      {"category": "aspect", "directory": "templates/cap/nodejs/db/", "description": "Reusable CDS aspects"},
      {"category": "schema", "directory": "templates/cap/nodejs/db/", "description": "Main schema file with namespace"}
    ],
    "serviceTemplates": [
      {"category": "service", "directory": "templates/cap/nodejs/srv/", "description": "Service definition"},
      {"category": "service-handler-js", "directory": "templates/cap/nodejs/srv/", "description": "JavaScript service handler"},
      {"category": "service-handler-ts", "directory": "templates/cap/nodejs/srv/", "description": "TypeScript service handler"}
    ],
    "eventHandlerTemplates": [
      {"category": "before-create", "directory": "templates/cap/nodejs/srv/events/", "description": "Before CREATE handler"},
      {"category": "after-create", "directory": "templates/cap/nodejs/srv/events/", "description": "After CREATE handler"},
      {"category": "on-action", "directory": "templates/cap/nodejs/srv/events/", "description": "Custom action handler"}
    ],
    "deploymentTemplates": [
      {"category": "mta", "directory": "templates/cap/mta/", "description": "MTA descriptor"},
      {"category": "xs-security", "directory": "templates/cap/mta/", "description": "XSUAA configuration"},
      {"category": "package-json", "directory": "templates/cap/mta/", "description": "CAP package.json"}
    ],
    "testTemplates": [
      {"category": "service-test", "directory": "templates/cap/nodejs/test/", "description": "Service handler unit test"}
    ]
  },
  "mcpServers": [
    {"name": "sap-documentation", "url": "https://mcp-sap-docs.marianzeis.de/mcp", "purpose": "SAP Help Portal, CAP, CDS, BTP documentation", "required": true},
    {"name": "atlassian", "url": "https://mcp.atlassian.com/v1/sse", "purpose": "Jira/Confluence integration for requirements", "required": false},
    {"name": "deepwiki", "url": "https://mcp.deepwiki.com/mcp", "purpose": "SAP CAP sample repositories and examples", "required": true}
  ],
  "projectStructure": {
    "directories": [
      {"path": ".cursor/agents/", "purpose": "AI agent definitions"},
      {"path": ".cursor/skills/", "purpose": "Reusable skills"},
      {"path": "knowledge/", "purpose": "CAP reference patterns"},
      {"path": "db/", "purpose": "CDS data models and schemas"},
      {"path": "srv/", "purpose": "Service definitions and handlers"},
      {"path": "app/", "purpose": "Fiori applications"},
      {"path": "test/", "purpose": "Unit and integration tests"},
      {"path": "docs/", "purpose": "Documentation"}
    ],
    "files": [
      {"path": ".cursorrules", "purpose": "Agent behavior rules"},
      {"path": "PURPOSE.md", "purpose": "Purpose document"},
      {"path": "README.md", "purpose": "Project documentation"},
      {"path": "package.json", "purpose": "Node.js dependencies"},
      {"path": "mta.yaml", "purpose": "Multi-target application descriptor"}
    ]
  },
  "enforcement": [
    {"patternId": "cds-best-practices", "required": true, "description": "Enforce CDS modeling best practices"},
    {"patternId": "cap-handler-patterns", "required": true, "description": "Ensure service handler patterns are followed"},
    {"patternId": "odata-annotation-compliance", "required": true, "description": "Validate OData and Fiori annotations"},
    {"patternId": "security-enforcement", "required": true, "description": "Enforce XSUAA and security patterns"},
    {"patternId": "test-coverage", "required": true, "description": "Require test coverage for handlers"}
  ],
  "testing": {
    "frameworks": [
      {"name": "Jest", "purpose": "Unit testing for Node.js CAP", "required": true},
      {"name": "Mocha", "purpose": "Alternative testing framework", "required": false},
      {"name": "cds.test", "purpose": "CAP testing utilities", "required": true}
    ],
    "patterns": [
      {"name": "Service Testing", "description": "Test service handlers with cds.test"},
      {"name": "Integration Testing", "description": "Test OData endpoints end-to-end"},
      {"name": "Mock Data", "description": "Use CSV files for test data"},
      {"name": "Isolated Testing", "description": "Each test should be independent"}
    ]
  },
  "deployment": {
    "patterns": [
      {"name": "MTA Deployment", "description": "Deploy CAP applications to BTP using MTA"},
      {"name": "Blue-Green Deployment", "description": "Zero-downtime deployments"},
      {"name": "Multi-Tenant", "description": "SaaS application patterns"},
      {"name": "CI/CD Integration", "description": "Automated testing and deployment"}
    ],
    "tools": [
      {"name": "MTA Build Tool", "purpose": "Build multi-target applications"},
      {"name": "Cloud Foundry CLI", "purpose": "Deploy to BTP Cloud Foundry"},
      {"name": "SAP BTP Cockpit", "purpose": "Manage deployed applications"}
    ]
  },
  "cursorrules": {
    "variables": [
      {"name": "CAP_RUNTIME", "description": "CAP runtime (nodejs or java)", "default": "nodejs"},
      {"name": "DATABASE", "description": "Target database", "default": "hana"},
      {"name": "MULTI_TENANT", "description": "Enable multi-tenancy", "default": "false"},
      {"name": "FIORI_ENABLED", "description": "Generate Fiori annotations", "default": "true"}
    ],
    "rules": [
      {"name": "CDS-First Development", "description": "Always start with CDS data models. Define entities, associations, and aspects before services."},
      {"name": "Service Definition", "description": "Expose entities through services. Use projections to control what's exposed."},
      {"name": "Handler Registration", "description": "Use this.on(), this.before(), this.after() for event handlers. Prefer async/await."},
      {"name": "Annotations", "description": "Add @UI, @Common, @Capabilities annotations for Fiori Elements. Place in separate annotation files."},
      {"name": "Error Handling", "description": "Use req.error() and req.reject() for proper error responses. Never throw raw exceptions."},
      {"name": "Transactions", "description": "CAP handles transactions automatically. Use cds.tx() only when needed."},
      {"name": "Security", "description": "Use @requires and @restrict annotations. Configure XSUAA properly."},
      {"name": "Testing", "description": "Write tests using cds.test. Use CSV files for test data. Test all CRUD operations."},
      {"name": "Deployment", "description": "Use MTA for deployment. Configure services in mta.yaml. Use managed services on BTP."},
      {"name": "MCP Integration", "description": "Use SAP documentation MCP for CAP, CDS, and BTP questions. Verify patterns against official docs."}
    ]
  },
  "capPatterns": {
    "handlerTypes": {
      "before": "Validation, authorization, data enrichment before persistence",
      "on": "Override default CRUD operations",
      "after": "Post-processing, side effects, notifications"
    },
    "annotationCategories": {
      "UI": "@UI.LineItem, @UI.Identification, @UI.FieldGroup, @UI.Facets",
      "Common": "@Common.Label, @Common.ValueList, @Common.Text",
      "Capabilities": "@readonly, @insertonly, @Capabilities.Insertable"
    },
    "deploymentOptions": {
      "sqlite": "Local development",
      "hana": "SAP HANA Cloud production",
      "postgres": "Alternative cloud database"
    }
  },
  "layerDefaults": {
    "layer0": {
      "coreAxioms": ["A1", "A2", "A3", "A4", "A5"],
      "optionalAxioms": ["A6", "A7"],
      "note": "A6 (Minimalism) keeps services focused. A7 (Reversibility) for deployment strategies."
    },
    "layer1": {
      "purposeTemplate": "To build modern cloud applications on SAP BTP using CAP with proper data modeling, service design, and deployment practices",
      "stakeholders": "Full-stack developers, Fiori developers, BTP administrators, business analysts"
    },
    "layer3": {
      "methodology": "agile-scrum",
      "note": "Scrum suits iterative CAP development with sprints for models, services, and UI."
    }
  }
}
