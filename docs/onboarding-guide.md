# Onboarding Guide

This guide explains how to integrate Cursor Agent Factory into existing repositories without destroying your current setup.

## Overview

The onboarding flow is designed for repositories that already have code, configurations, and potentially some Cursor artifacts. It provides:

- **Non-destructive integration** - Preserves your existing files
- **Conflict resolution** - Handles overlapping artifacts gracefully
- **Backup and rollback** - Safety net for all changes
- **Tech stack detection** - Automatically suggests appropriate blueprints

## Quick Start

### 1. Analyze Your Repository

First, analyze your repository to see what exists:

```bash
python cli/factory_cli.py --analyze C:\Projects\my-existing-repo
```

This shows:
- Detected Cursor artifacts
- Technology stack
- Suggested blueprint
- Onboarding scenario

### 2. Preview Changes (Dry Run)

See what would be changed without making any modifications:

```bash
python cli/factory_cli.py --onboard C:\Projects\my-existing-repo --dry-run
```

### 3. Execute Onboarding

When ready, run the onboarding:

```bash
python cli/factory_cli.py --onboard C:\Projects\my-existing-repo
```

Or with a specific blueprint:

```bash
python cli/factory_cli.py --onboard C:\Projects\my-existing-repo --blueprint csharp-dotnet
```

### 4. Rollback If Needed

If something goes wrong, rollback to the previous state:

```bash
python cli/factory_cli.py --rollback C:\Projects\my-existing-repo
```

## Onboarding Scenarios

The analyzer detects which scenario applies to your repository:

### FRESH - No Cursor Artifacts

Your repository has no Cursor-related files. The onboarding will:
- Create complete `.cursor/` structure
- Generate `.cursorrules` from detected tech stack
- Add agents, skills, and knowledge files
- Create templates and workflows

### MINIMAL - Only .cursorrules Exists

Your repository has a `.cursorrules` file but no other artifacts. The onboarding will:
- Preserve your existing `.cursorrules`
- Add missing agents and skills
- Add knowledge files
- Create templates and workflows

### PARTIAL - Some Artifacts Missing

Your repository has some Cursor artifacts but is missing others. The onboarding will:
- Preserve all existing artifacts
- Add only missing components
- Merge new sections into `.cursorrules`
- Handle conflicts interactively

### UPGRADE - Old Factory Version

Your repository was generated by an older version of the factory. The onboarding will:
- Detect the version difference
- Offer section-by-section upgrade
- Preserve your customizations
- Update to new patterns

### COMPLETE - Fully Configured

Your repository already has all standard artifacts. The onboarding will:
- Report status
- Offer optional enhancements
- Make no changes unless explicitly requested

## Conflict Resolution

When the onboarding finds conflicts (same-named artifacts with different content), you'll be asked to resolve each one:

### Agent/Skill Conflicts

```
=== CONFLICT: agent 'code-reviewer' ===

Existing file: .cursor/agents/code-reviewer.md

Differences:
  +45 lines, -12 lines

Recommendation: keep - Preserve existing customizations

Options:
  * [1] keep
    [2] replace
    [3] rename
```

Options:
- **keep** - Keep your existing version (recommended for customized files)
- **replace** - Replace with factory version
- **rename** - Create factory version with suffix (e.g., `code-reviewer-factory.md`)

### .cursorrules Conflicts

```
=== CONFLICT: cursorrules '.cursorrules' ===

Recommendation: merge - Merge preserves existing customizations while adding new sections

Options:
    [1] keep
  * [2] replace
    [3] merge
```

Options:
- **keep** - Keep your existing file unchanged
- **replace** - Replace with factory-generated version
- **merge** - Add factory sections while preserving your content (recommended)

### Knowledge File Conflicts

Options:
- **keep** - Keep your existing JSON file
- **replace** - Replace with factory version
- **merge** - Deep merge both JSON files

## Backup System

Every onboarding creates a backup session in `.cursor-factory-backup/`:

```
.cursor-factory-backup/
├── 20260129_143022/
│   ├── manifest.json
│   ├── .cursorrules
│   └── .cursor/
│       └── agents/
│           └── code-reviewer.md
```

### Viewing Backup Sessions

```bash
python scripts/backup_manager.py C:\Projects\my-repo list
```

### Rolling Back

```bash
# List sessions and choose interactively
python cli/factory_cli.py --rollback C:\Projects\my-repo

# Rollback specific session
python cli/factory_cli.py --rollback C:\Projects\my-repo --session-id 20260129_143022
```

### Cleanup Old Backups

```bash
python scripts/backup_manager.py C:\Projects\my-repo cleanup
```

## Tech Stack Detection

The analyzer detects your technology stack from:

| File/Pattern | Detected |
|--------------|----------|
| `*.csproj`, `*.sln` | C#/.NET |
| `requirements.txt` + "fastapi" | Python FastAPI |
| `package.json` + "react" | TypeScript React |
| `pom.xml` + "spring" | Java Spring |
| `build.gradle.kts` | Kotlin |

## Available Blueprints

| Blueprint | Tech Stack | Best For |
|-----------|------------|----------|
| `python-fastapi` | Python, FastAPI, SQLAlchemy | REST APIs |
| `typescript-react` | TypeScript, React, Node.js | Web apps |
| `java-spring` | Java, Spring Boot, JPA | Enterprise apps |
| `kotlin-spring` | Kotlin, Spring Boot | Kotlin apps |
| `csharp-dotnet` | C#, .NET, ASP.NET Core | .NET apps |
| `sap-abap` | ABAP, SAP | SAP development |
| `sap-cpi-pi` | Groovy, iFlows | SAP integration |

## Protected Files

The following files are **never overwritten** during onboarding:

- `.cursor/commands/*` - Your custom commands
- `.cursor/rules/*` - Your custom rule files
- `PURPOSE.md` - Your purpose document
- `practices.yaml` - Your team practices
- `workflows/methodology.yaml` - Your methodology

These files may have suggestions offered, but require explicit user action to modify.

## Interactive vs CLI Mode

### CLI Mode (Default)

Use command-line arguments for automation:

```bash
python cli/factory_cli.py --onboard C:\Projects\my-repo --blueprint python-fastapi
```

### Agent Mode (Interactive)

In Cursor IDE, activate the `onboarding-architect` agent:

```
"Please onboard my repository at C:\Projects\my-repo"
```

The agent will:
1. Ask clarifying questions
2. Run analysis
3. Present options
4. Guide you through conflicts
5. Execute with your confirmation

## Troubleshooting

### Permission Denied

```
Error: Could not create backup - permission denied
```

**Solution:** Run as administrator or check file permissions.

### Unknown Tech Stack

```
Warning: Could not detect tech stack
```

**Solution:** Specify blueprint explicitly with `--blueprint`.

### Backup Directory Exists

The backup directory is automatically added to `.gitignore`. If you see backup files in git status, add manually:

```
.cursor-factory-backup/
```

### Rollback Failed

If rollback fails partway:
1. Check the manifest file for the session
2. Manually restore files from the backup directory
3. Files are stored with original paths preserved

## Best Practices

1. **Always run dry-run first** - Preview changes before committing
2. **Keep existing customizations** - Default to preserving your work
3. **Review merged files** - After merge, verify the result looks correct
4. **Commit before onboarding** - Have a clean git state as additional safety
5. **Test after onboarding** - Verify agents and skills work correctly

## Example Workflow

```bash
# 1. Ensure clean git state
git status  # Should be clean

# 2. Analyze repository
python cli/factory_cli.py --analyze C:\Projects\my-app

# 3. Preview changes
python cli/factory_cli.py --onboard C:\Projects\my-app --dry-run

# 4. Execute onboarding
python cli/factory_cli.py --onboard C:\Projects\my-app --blueprint csharp-dotnet

# 5. Review changes
git status
git diff .cursorrules

# 6. If satisfied, commit
git add .
git commit -m "Integrate Cursor Agent Factory"

# 7. If not satisfied, rollback
python cli/factory_cli.py --rollback C:\Projects\my-app
```

---

*Cursor Agent Factory v2.0.0*
*Onboarding Guide*
