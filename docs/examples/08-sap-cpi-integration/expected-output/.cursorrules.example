# Order Replication CPI - Cursor Agent Rules
# Generated by Cursor Agent Factory
# 5-Layer Architecture for SAP CPI/PI Integration

# ═══════════════════════════════════════════════════════════════════════════════
# LAYER 0: INTEGRITY & LOGIC (Axioms)
# ═══════════════════════════════════════════════════════════════════════════════

## Core Axioms (Immutable)

### A1: Verifiability
All code must be testable:
- Spock tests for all Groovy scripts
- Mock CPI environment for testing
- Test coverage for error scenarios

### A2: User Primacy
Business process needs first:
- Reliable data delivery
- Clear error notifications
- Proper audit trail

### A3: Transparency
Clear logging for troubleshooting:
- Use messageLog for all steps
- Log input/output at key points
- Include correlation IDs

### A4: Non-Harm
No data loss:
- Proper error handling
- Retry mechanisms
- Dead letter queue for failures

### A5: Consistency
CPI patterns throughout:
- Standard script structure
- Consistent error handling
- Uniform logging format

## Optional Axioms (Selected)

### A6: Minimalism
Simple, focused scripts:
- Single responsibility per script
- No over-engineering
- Use standard CPI features

### A7: Reversibility
Transport-based deployment:
- All changes via transport
- Rollback capability
- Version control for scripts

# ═══════════════════════════════════════════════════════════════════════════════
# LAYER 1: PURPOSE
# ═══════════════════════════════════════════════════════════════════════════════

## Mission
To build reliable SAP integrations with proper error handling, monitoring, and
maintainability.

## Primary Stakeholders
SAP integration developers and the business processes that depend on reliable
data flow.

## Success Criteria
Zero unhandled exceptions with complete logging for rapid troubleshooting.

# ═══════════════════════════════════════════════════════════════════════════════
# LAYER 2: PRINCIPLES
# ═══════════════════════════════════════════════════════════════════════════════

## Quality Standards

### Groovy Code Quality
- Use safe navigation (?.) for null handling
- Use messageLog, never System.out
- Proper try-catch in all scripts
- Use closures for collections

### iFlow Quality
- Exception subprocess for error handling
- Proper timeout configuration
- Correlation ID propagation
- Complete logging at each step

# ═══════════════════════════════════════════════════════════════════════════════
# LAYER 3: METHODOLOGY
# ═══════════════════════════════════════════════════════════════════════════════

## Development Methodology: Kanban

### Flow Management
- Pull-based work assignment
- WIP limit: 3 per developer
- Priority-based queue

### Quality Gates
- All scripts have tests
- Code review completed
- Tested in QA tenant

# ═══════════════════════════════════════════════════════════════════════════════
# LAYER 4: TECHNICAL
# ═══════════════════════════════════════════════════════════════════════════════

## Technology Stack

### Platform
- SAP Integration Suite / CPI
- SAP PI/PO (on-premise alternative)

### Languages
- Groovy (primary)
- Java (custom adapters)

### Testing
- Spock Framework
- Mock message objects

## Project Structure
```
src/main/groovy/
├── scripts/          # Processing scripts
└── mappings/         # Transformation scripts
src/test/groovy/      # Spock tests
iflows/               # iFlow definitions
```

## Groovy Conventions

### Script Structure
- Header comment with purpose
- Try-catch wrapper
- Logging at entry/exit
- Error properties set on failure

### Naming
- Scripts: camelCase (orderMapping.groovy)
- Tests: ScriptNameSpec.groovy
- Methods: camelCase

# ═══════════════════════════════════════════════════════════════════════════════
# AGENT REGISTRY
# ═══════════════════════════════════════════════════════════════════════════════

## Available Agents

### code-reviewer
- Focus: Groovy patterns, CPI best practices
- Skills: groovy-scripting, grounding

### test-generator
- Focus: Spock tests for scripts
- Skills: tdd

## Available Skills

### groovy-scripting
- Purpose: Groovy script development
- Patterns: From knowledge/groovy-patterns.json

### error-handling
- Purpose: Exception handling in iFlows
- Patterns: From knowledge/iflow-patterns.json

### grounding
- Purpose: Verify against SAP documentation
- MCP: SAP Documentation

### tdd
- Purpose: Test-driven script development
- Framework: Spock

# ═══════════════════════════════════════════════════════════════════════════════
# BEHAVIOR RULES
# ═══════════════════════════════════════════════════════════════════════════════

## Groovy Rules
1. Always use messageLog for logging
2. Always wrap logic in try-catch
3. Use safe navigation (?.) for nulls
4. Never hardcode credentials
5. Use message properties for configuration

## Testing Rules
1. Write Spock test for every script
2. Test null handling
3. Test error scenarios
4. Use mock message objects

## iFlow Rules
1. Use exception subprocess
2. Configure appropriate timeouts
3. Add correlation IDs
4. Log at major steps
