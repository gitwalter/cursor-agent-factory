{
  "metadata": {
    "patternId": "sap-grounding",
    "patternName": "SAP Grounding Coordinator",
    "category": "sap-grounding",
    "stackAgnostic": false,
    "description": "Coordinator skill that orchestrates all specialized SAP grounding skills based on artifact type",
    "composable": true,
    "version": "1.0.0"
  },
  "frontmatter": {
    "name": "sap-grounding",
    "description": "Master coordinator for all SAP grounding operations - routes to specialized skills based on artifact type",
    "type": "skill",
    "knowledge": ["released-apis.json", "deprecated-apis.json"],
    "composes": [
      "ddic-grounding",
      "cds-grounding",
      "rap-grounding",
      "class-grounding",
      "function-grounding",
      "api-grounding",
      "enhancement-grounding",
      "message-grounding",
      "authorization-grounding",
      "mapping-grounding",
      "existence-grounding",
      "fiori-grounding",
      "strawberry-verification"
    ]
  },
  "sections": {
    "title": "SAP Grounding Coordinator",
    "introduction": "Master coordination skill that ensures comprehensive grounding for all SAP development artifacts. Routes verification requests to specialized grounding skills based on artifact type, aggregates results, and invokes mathematical verification via Strawberry for final validation.",
    "architecture": {
      "description": "Multi-layer grounding architecture with 12 specialized skills and mathematical verification",
      "layers": [
        {
          "layer": 1,
          "name": "Knowledge Cache",
          "description": "Pre-verified definitions in knowledge files"
        },
        {
          "layer": 2,
          "name": "SAP Official Documentation",
          "description": "SAP Help Portal, ABAP documentation via MCP"
        },
        {
          "layer": 3,
          "name": "Reference Repositories",
          "description": "abap-cheat-sheets, best practices, code samples"
        },
        {
          "layer": 4,
          "name": "Project Specifications",
          "description": "Confluence, Excel, JIRA mapping specifications"
        },
        {
          "layer": 5,
          "name": "Strawberry Verification",
          "description": "Mathematical hallucination detection via budget_gap analysis"
        }
      ]
    },
    "skillRouting": {
      "ddic-grounding": {
        "triggerArtifacts": ["TABLE", "TABL", "STRUCTURE", "STRU", "DATA_ELEMENT", "DTEL", "DOMAIN", "DOMA", "TABLE_TYPE", "TTYP", "SEARCH_HELP", "SHLP", "LOCK_OBJECT", "ENQU"],
        "keywords": ["table", "structure", "field", "data element", "domain", "search help", "lock object", "foreign key"]
      },
      "cds-grounding": {
        "triggerArtifacts": ["CDS_VIEW", "DDLS", "CDS_ENTITY", "CDS_ROLE", "DCLS", "CDS_METADATA_EXTENSION", "DDLX"],
        "keywords": ["cds", "view entity", "annotation", "association", "composition", "access control"]
      },
      "rap-grounding": {
        "triggerArtifacts": ["BEHAVIOR_DEFINITION", "BDEF", "RAP_BO"],
        "keywords": ["rap", "behavior", "action", "determination", "validation", "draft", "side effect"]
      },
      "class-grounding": {
        "triggerArtifacts": ["CLASS", "CLAS", "INTERFACE", "INTF", "EXCEPTION_CLASS"],
        "keywords": ["class", "interface", "method", "exception", "inheritance", "instantiate"]
      },
      "function-grounding": {
        "triggerArtifacts": ["FUNCTION_MODULE", "FUGR", "FUNC", "BAPI", "RFC"],
        "keywords": ["function module", "function group", "bapi", "rfc", "call function"]
      },
      "api-grounding": {
        "triggerArtifacts": ["ODATA_SERVICE", "SRVB", "SRVD", "WEB_SERVICE", "SOAP"],
        "keywords": ["odata", "service binding", "api", "entity set", "web service"]
      },
      "enhancement-grounding": {
        "triggerArtifacts": ["ENHANCEMENT_SPOT", "ENHS", "BADI", "ENHANCEMENT_IMPLEMENTATION", "ENHO"],
        "keywords": ["enhancement", "badi", "business add-in", "enhancement spot", "plug-in"]
      },
      "message-grounding": {
        "triggerArtifacts": ["MESSAGE_CLASS", "MSAG"],
        "keywords": ["message", "message class", "t100", "error message"]
      },
      "authorization-grounding": {
        "triggerArtifacts": ["AUTHORIZATION_OBJECT", "SUSO", "AUTH"],
        "keywords": ["authorization", "authority-check", "auth object", "pfcg", "role"]
      },
      "mapping-grounding": {
        "triggerArtifacts": ["MAPPING", "TRANSFORMATION"],
        "keywords": ["mapping", "field mapping", "structure mapping", "transformation", "specification"]
      },
      "existence-grounding": {
        "triggerArtifacts": ["ANY", "UNKNOWN"],
        "keywords": ["exists", "existence", "released", "deprecated", "c0", "c1", "c2", "abap cloud"]
      },
      "fiori-grounding": {
        "triggerArtifacts": ["FIORI_APP", "WAPA", "SEMANTIC_OBJECT", "UI5_COMPONENT"],
        "keywords": ["fiori", "ui5", "semantic object", "launchpad", "tile", "target mapping"]
      }
    },
    "whenToUse": [
      "ALWAYS before implementing any SAP-related code",
      "When referencing SAP objects of any type",
      "When uncertain which specialized skill to use",
      "For comprehensive verification across multiple artifact types",
      "Before finalizing any implementation"
    ],
    "process": [
      {
        "step": 1,
        "name": "Identify Artifacts",
        "description": "Parse request to identify all SAP artifacts that need grounding",
        "actions": [
          "Extract object names and types from request",
          "Identify keywords indicating artifact types",
          "Build list of artifacts to verify"
        ]
      },
      {
        "step": 2,
        "name": "Route to Specialized Skills",
        "description": "Dispatch verification to appropriate specialized skills",
        "actions": [
          "Map each artifact to appropriate grounding skill",
          "Invoke specialized skills in parallel where possible",
          "Collect verification results"
        ]
      },
      {
        "step": 3,
        "name": "Check Release Status",
        "description": "Verify all artifacts for target environment",
        "actions": [
          "Invoke existence-grounding for release contracts",
          "Check ABAP Cloud compatibility if applicable",
          "Flag deprecated objects"
        ]
      },
      {
        "step": 4,
        "name": "Aggregate Results",
        "description": "Combine all verification results",
        "actions": [
          "Merge results from all specialized skills",
          "Identify any conflicts or issues",
          "Calculate overall confidence level"
        ]
      },
      {
        "step": 5,
        "name": "Prepare Evidence Spans",
        "description": "Format evidence for Strawberry verification",
        "actions": [
          "Collect evidence from all sources",
          "Format as numbered spans (S0, S1, S2...)",
          "Include provenance information"
        ]
      },
      {
        "step": 6,
        "name": "Invoke Strawberry Verification",
        "description": "Mathematical verification of claims against evidence",
        "actions": [
          "Call strawberry-verification skill",
          "Pass all claims with evidence citations",
          "Analyze budget_gap results"
        ]
      },
      {
        "step": 7,
        "name": "Generate Final Report",
        "description": "Produce comprehensive grounding report",
        "actions": [
          "Compile all verification results",
          "Highlight any issues or warnings",
          "Provide clear recommendation"
        ]
      },
      {
        "step": 8,
        "name": "Decide Proceed or Stop",
        "description": "Determine if implementation should proceed",
        "decisionLogic": {
          "PROCEED": "All critical artifacts verified with HIGH confidence, no Strawberry flags",
          "PROCEED_WITH_WARNINGS": "Verified but with warnings (deprecated, not released, etc.)",
          "STOP": "Critical artifacts unverified OR Strawberry budget_gap > 10",
          "ASK_USER": "Medium confidence verification OR budget_gap 2-10"
        }
      }
    ],
    "outputFormat": "### SAP Grounding Report\n\n**Request:** {SUMMARY}\n**Artifacts Analyzed:** {COUNT}\n**Overall Confidence:** {HIGH|MEDIUM|LOW}\n**Strawberry Verification:** {PASSED|WARNING|FAILED}\n\n---\n\n#### Artifact Verification Summary\n\n| Artifact | Type | Skill Used | Status | Confidence | Issues |\n|----------|------|------------|--------|------------|--------|\n| {ARTIFACT} | {TYPE} | {SKILL} | {VERIFIED|UNVERIFIED} | {H/M/L} | {ISSUES} |\n\n---\n\n#### Release Contract Status\n\n| Artifact | C0 | C1 | C2 | ABAP Cloud |\n|----------|----|----|----|-----------|\n| {ARTIFACT} | {Y/N} | {Y/N} | {Y/N} | {Y/N} |\n\n---\n\n#### Strawberry Verification Results\n\n| Claim | Budget Gap | Status | Action |\n|-------|------------|--------|--------|\n| {CLAIM} | {GAP} | {OK|WARN|FAIL} | {ACTION} |\n\n---\n\n#### Issues and Warnings\n\n1. {ISSUE_1}\n2. {ISSUE_2}\n...\n\n---\n\n### RECOMMENDATION: {PROCEED|PROCEED_WITH_WARNINGS|STOP|ASK_USER}\n\n**Reason:** {RECOMMENDATION_REASON}\n\n**Required Actions:**\n- {ACTION_1}\n- {ACTION_2}",
    "importantRules": [
      "ALWAYS invoke this skill before any SAP implementation",
      "Route ALL artifacts to appropriate specialized skills",
      "NEVER skip existence-grounding for any object",
      "ALWAYS invoke strawberry-verification as final gate",
      "If ANY critical artifact fails, STOP immediately",
      "Document ALL verification sources for traceability",
      "When in doubt, ASK USER before proceeding"
    ],
    "confidenceAggregation": {
      "HIGH": "All specialized skills report HIGH confidence",
      "MEDIUM": "At least one skill reports MEDIUM, none LOW",
      "LOW": "Any skill reports LOW or UNVERIFIED"
    },
    "fallbackProcedures": [
      {
        "condition": "Cannot identify artifact type",
        "action": "Use existence-grounding for basic verification, then ASK USER for clarification"
      },
      {
        "condition": "Specialized skill fails",
        "action": "Log error, continue with other skills, report partial verification"
      },
      {
        "condition": "Strawberry unavailable",
        "action": "WARN: Mathematical verification skipped. Proceed with domain grounding only."
      },
      {
        "condition": "Mixed verification results",
        "action": "Report detailed breakdown, recommend based on critical path items"
      }
    ]
  },
  "variables": [
    {"name": "{ARTIFACTS}", "description": "List of artifacts to ground", "required": true},
    {"name": "{TARGET_ENVIRONMENT}", "description": "Target environment (standard, cloud)", "required": false},
    {"name": "{SKIP_STRAWBERRY}", "description": "Skip mathematical verification (not recommended)", "required": false}
  ]
}
