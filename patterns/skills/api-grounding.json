{
  "metadata": {
    "patternId": "api-grounding",
    "patternName": "API Grounding Skill",
    "category": "sap-grounding",
    "stackAgnostic": false,
    "description": "Verify SAP service APIs including OData, RAP Service Bindings, SOAP, and RFC destinations",
    "composable": true,
    "version": "1.0.0"
  },
  "frontmatter": {
    "name": "api-grounding",
    "description": "Verify SAP API and service artifacts including OData services, RAP service bindings, and web services",
    "type": "skill",
    "knowledge": ["api-catalog.json", "released-apis.json"]
  },
  "sections": {
    "title": "API Grounding Skill",
    "introduction": "Ensures all SAP API and service artifacts are verified before implementation. Covers OData services, RAP service bindings, SOAP web services, and RFC destinations.",
    "artifactTypes": [
      {
        "type": "odata_service",
        "description": "OData V2 and V4 services",
        "verifications": ["existence", "entity_sets", "entity_types", "actions", "functions", "navigation_properties"]
      },
      {
        "type": "rap_service_binding",
        "description": "RAP OData and InA service bindings",
        "verifications": ["existence", "bound_entities", "protocol_version", "service_definition"]
      },
      {
        "type": "soap_service",
        "description": "SOAP web services",
        "verifications": ["existence", "operations", "data_types", "wsdl"]
      },
      {
        "type": "rfc_destination",
        "description": "RFC connection destinations",
        "verifications": ["existence", "connection_type", "target_system", "availability"]
      }
    ],
    "protocolVersions": {
      "odata_v2": "OData Version 2 - uses SEGW or CDS with @OData.publish",
      "odata_v4": "OData Version 4 - RAP service binding",
      "ina": "InA protocol for SAP Analytics"
    },
    "whenToUse": [
      "When consuming or exposing OData services",
      "Before implementing RAP service bindings",
      "When integrating with SOAP web services",
      "Before assuming service entities or operations exist",
      "When configuring RFC destinations"
    ],
    "process": [
      {
        "step": 1,
        "name": "Check Knowledge Cache",
        "description": "Look for cached API definitions",
        "actions": [
          "Query knowledge/api-catalog.json for service definitions",
          "Check released-apis.json for released services"
        ]
      },
      {
        "step": 2,
        "name": "Search SAP Documentation",
        "description": "Search for API documentation",
        "mcpTools": ["SAP_Documentation_MCP_Server-search", "SAP_Documentation_MCP_Server-sap_help_search"],
        "queryPatterns": {
          "odata": "{SERVICE_NAME} OData service entity set",
          "rap_binding": "{BINDING_NAME} RAP service binding",
          "api": "{API_NAME} SAP API Business Hub"
        }
      },
      {
        "step": 3,
        "name": "Search SAP Business Accelerator Hub",
        "description": "Check SAP Business Accelerator Hub for API specs",
        "actions": [
          "Search for API in SAP Business Accelerator Hub",
          "Check API availability per SAP product",
          "Verify API version compatibility"
        ]
      },
      {
        "step": 4,
        "name": "Verify Service Existence",
        "description": "Confirm service is registered",
        "verifications": [
          "Service is active and published",
          "Service URL/endpoint is accessible",
          "Protocol version matches expectations"
        ]
      },
      {
        "step": 5,
        "name": "Verify Entity Sets",
        "description": "Check OData entity sets",
        "verifications": [
          "Entity set name exists",
          "Entity type properties match",
          "Key properties defined",
          "Navigation properties valid"
        ]
      },
      {
        "step": 6,
        "name": "Verify Operations",
        "description": "Check service operations",
        "verifications": [
          "Actions/Functions exist",
          "Operation parameters",
          "Return types",
          "Bound vs unbound operations"
        ]
      },
      {
        "step": 7,
        "name": "Verify RAP Service Binding",
        "description": "For RAP, verify binding configuration",
        "verifications": [
          "Service definition exists",
          "Bound entities are exposed",
          "Protocol version (OData V4, InA)",
          "Local vs remote consumption"
        ]
      },
      {
        "step": 8,
        "name": "Check Release Status",
        "description": "Verify API release for consumption",
        "verifications": [
          "API is released for external consumption",
          "Stability classification (stable, beta)",
          "Deprecation notices"
        ]
      },
      {
        "step": 9,
        "name": "Document and Escalate",
        "description": "Record results and handle failures",
        "actions": [
          "Document all verifications",
          "STOP and ASK if service unverified",
          "Suggest alternatives for deprecated APIs"
        ]
      }
    ],
    "outputFormat": "### API/Service Verification Results\n\n**Service:** {SERVICE_NAME}\n**Type:** {ODATA_V2|ODATA_V4|SOAP|RFC}\n**Release Status:** {RELEASED|BETA|NOT_RELEASED}\n**Endpoint:** {ENDPOINT_URL}\n\n#### Entity Sets Verified (OData)\n| Entity Set | Entity Type | Key | CRUD | Verified |\n|------------|-------------|-----|------|----------|\n| {ENTITY_SET} | {TYPE} | {KEY} | {CRUD} | {YES/NO} |\n\n#### Operations Verified\n| Operation | Type | Parameters | Return | Verified |\n|-----------|------|------------|--------|----------|\n| {OPERATION} | {ACTION|FUNCTION} | {PARAMS} | {RETURN} | {YES/NO} |\n\n#### RAP Binding (if applicable)\n- **Service Definition:** {SRVD_NAME}\n- **Protocol:** {ODATA_V4|INA}\n- **Bound Entities:** {ENTITY_LIST}\n\n**Issues Found:**\n- {ISSUE_LIST}\n\n**Recommendation:** {PROCEED|STOP|ASK_USER}",
    "importantRules": [
      "NEVER assume entity sets or operations exist without verification",
      "OData V2 and V4 have different capabilities - verify protocol",
      "Navigation properties must target valid entity sets",
      "Action/Function parameters must match expected types",
      "Released APIs should be preferred over internal services",
      "If service unverified, STOP and ASK user"
    ],
    "fallbackProcedures": [
      {
        "condition": "Service not found",
        "action": "ASK USER: 'Cannot verify service {SERVICE}. Is this a custom service? Please provide its specification.'"
      },
      {
        "condition": "Entity set not found",
        "action": "Report that entity set does not exist. List available entity sets if known."
      },
      {
        "condition": "Service not released",
        "action": "WARN: Service is not released for external consumption. Use at own risk."
      },
      {
        "condition": "API deprecated",
        "action": "WARN: API is deprecated. Suggest successor: {SUCCESSOR_API}"
      }
    ]
  },
  "variables": [
    {"name": "{SERVICE_NAME}", "description": "Name of the service", "required": true},
    {"name": "{ENTITY_SET}", "description": "Entity set to verify (optional)", "required": false},
    {"name": "{OPERATION}", "description": "Operation to verify (optional)", "required": false},
    {"name": "{PROTOCOL}", "description": "Expected protocol version", "required": false}
  ]
}
