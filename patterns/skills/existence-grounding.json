{
  "metadata": {
    "patternId": "existence-grounding",
    "patternName": "Existence Grounding Skill",
    "category": "sap-grounding",
    "stackAgnostic": false,
    "description": "Verify SAP repository object existence, release contracts, package assignments, and deprecation status",
    "composable": true,
    "version": "1.0.0"
  },
  "frontmatter": {
    "name": "existence-grounding",
    "description": "Verify that SAP repository objects exist and are available for the target environment",
    "type": "skill",
    "knowledge": ["released-apis.json", "deprecated-apis.json", "release-matrix.json"]
  },
  "sections": {
    "title": "Existence Grounding Skill",
    "introduction": "Ensures SAP repository objects exist and are appropriate for use in the target environment. Verifies TADIR entries, package assignments, release contracts (C0/C1/C2), deprecation status, and release availability. Critical for preventing hallucinations.",
    "artifactTypes": [
      {
        "type": "repository_object",
        "description": "Any SAP repository object",
        "verifications": ["tadir_entry", "object_type", "object_name", "package", "component"]
      },
      {
        "type": "release_contract",
        "description": "API stability contract",
        "verifications": ["c0_extend", "c1_use", "c2_remote", "visibility"]
      },
      {
        "type": "deprecation",
        "description": "Obsolete or deprecated status",
        "verifications": ["deprecated_flag", "successor_object", "deprecation_date"]
      },
      {
        "type": "release_availability",
        "description": "Availability by SAP release",
        "verifications": ["minimum_release", "maximum_release", "sap_notes"]
      }
    ],
    "objectTypes": {
      "R3TR": "Main object types (programs, tables, classes, etc.)",
      "LIMU": "Sub-object types (methods, includes, etc.)"
    },
    "releaseContracts": {
      "C0": {
        "name": "Extend",
        "description": "Can be extended (inherited, implemented, enhanced)",
        "usage": "Subclassing, interface implementation, BAdI implementation"
      },
      "C1": {
        "name": "System-Internal Use",
        "description": "Can be used within the same system",
        "usage": "Instantiation, method calls, type references"
      },
      "C2": {
        "name": "Remote API",
        "description": "Can be accessed from external systems",
        "usage": "RFC calls, OData consumption, external integration"
      }
    },
    "abapEnvironments": {
      "standard": "On-premise ABAP (full language version)",
      "cloud": "ABAP Cloud (restricted, BTP)",
      "steampunk": "SAP BTP ABAP Environment"
    },
    "whenToUse": [
      "Before referencing ANY SAP object in code",
      "When checking if an object exists in target system",
      "When verifying ABAP Cloud compatibility",
      "Before using objects that may be deprecated",
      "When planning upgrade impact assessment"
    ],
    "process": [
      {
        "step": 1,
        "name": "Check Knowledge Cache",
        "description": "Look for cached object information",
        "actions": [
          "Query knowledge/released-apis.json for release contracts",
          "Query knowledge/deprecated-apis.json for deprecation status",
          "Query knowledge/release-matrix.json for release availability"
        ]
      },
      {
        "step": 2,
        "name": "Search SAP Documentation",
        "description": "Search for object in SAP documentation",
        "mcpTools": ["SAP_Documentation_MCP_Server-search", "SAP_Documentation_MCP_Server-sap_help_search"],
        "queryPatterns": {
          "object": "{OBJECT_NAME} {OBJECT_TYPE} SAP",
          "release": "{OBJECT_NAME} released API ABAP Cloud",
          "deprecated": "{OBJECT_NAME} deprecated obsolete successor"
        }
      },
      {
        "step": 3,
        "name": "Verify Object Existence",
        "description": "Confirm object exists in SAP",
        "verifications": [
          "Object mentioned in SAP documentation",
          "Object type is valid (TABL, CLAS, INTF, etc.)",
          "Object is part of standard SAP delivery"
        ]
      },
      {
        "step": 4,
        "name": "Check TADIR Assignment",
        "description": "Verify object registration",
        "verifications": [
          "Object registered in TADIR",
          "Package assignment",
          "Software component",
          "Application component"
        ]
      },
      {
        "step": 5,
        "name": "Verify Release Contracts",
        "description": "Check API stability contracts",
        "verifications": [
          "C0 (Extend) - Required for inheritance/implementation",
          "C1 (Use) - Required for usage in ABAP Cloud",
          "C2 (Remote) - Required for external access",
          "Visibility scope"
        ]
      },
      {
        "step": 6,
        "name": "Check Deprecation Status",
        "description": "Verify if object is deprecated",
        "verifications": [
          "Deprecation flag set",
          "Deprecation date",
          "Successor object available",
          "Migration notes"
        ]
      },
      {
        "step": 7,
        "name": "Check Release Availability",
        "description": "Verify availability in target release",
        "verifications": [
          "Minimum SAP release required",
          "Maximum release (if retired)",
          "SAP Notes for backporting",
          "Feature toggles or switches"
        ]
      },
      {
        "step": 8,
        "name": "Environment Compatibility",
        "description": "Check target environment compatibility",
        "verifications": [
          "Available in ABAP Cloud (if target)",
          "Available in on-premise (if target)",
          "Tier 1/2 API (for ABAP Cloud)"
        ]
      },
      {
        "step": 9,
        "name": "Document and Escalate",
        "description": "Record results and handle issues",
        "actions": [
          "Document existence verification with sources",
          "STOP and FLAG if object cannot be verified",
          "Report deprecation with successor",
          "WARN if not released for target environment"
        ]
      }
    ],
    "outputFormat": "### Existence Verification Results\n\n**Object:** {OBJECT_NAME}\n**Type:** {OBJECT_TYPE}\n**Exists:** {YES|NO|UNVERIFIED}\n**Confidence:** {HIGH|MEDIUM|LOW}\n\n#### Registration\n| Property | Value | Verified |\n|----------|-------|----------|\n| Package | {PACKAGE} | {YES/NO} |\n| Component | {COMPONENT} | {YES/NO} |\n| Application | {APPL} | {YES/NO} |\n\n#### Release Contracts\n| Contract | Status | Verified |\n|----------|--------|----------|\n| C0 (Extend) | {YES|NO|N/A} | {YES/NO} |\n| C1 (Use) | {YES|NO|N/A} | {YES/NO} |\n| C2 (Remote) | {YES|NO|N/A} | {YES/NO} |\n\n#### Deprecation Status\n- **Deprecated:** {YES|NO}\n- **Successor:** {SUCCESSOR_OBJECT}\n- **Migration Notes:** {NOTES}\n\n#### Release Availability\n- **Minimum Release:** {MIN_RELEASE}\n- **ABAP Cloud Compatible:** {YES|NO}\n- **SAP Notes:** {NOTE_NUMBERS}\n\n**Issues Found:**\n- {ISSUE_LIST}\n\n**Recommendation:** {PROCEED|STOP|USE_ALTERNATIVE|ASK_USER}",
    "importantRules": [
      "NEVER assume an object exists without verification",
      "Hallucinated objects are the primary failure mode - verify everything",
      "Release contracts are mandatory for ABAP Cloud projects",
      "Deprecated objects should be avoided - use successors",
      "Custom objects (Y/Z namespace) cannot be verified - ask user",
      "If object cannot be verified, STOP and FLAG immediately"
    ],
    "fallbackProcedures": [
      {
        "condition": "Object not found in documentation",
        "action": "FLAG: 'Cannot verify existence of {OBJECT}. This may be a hallucination. Please confirm this object exists in your system.'"
      },
      {
        "condition": "Object is customer namespace (Y/Z)",
        "action": "ASK USER: '{OBJECT} appears to be a custom object. Please confirm it exists and provide its definition.'"
      },
      {
        "condition": "Object is deprecated",
        "action": "WARN: '{OBJECT}' is deprecated. Successor: {SUCCESSOR}. Consider using the successor object."
      },
      {
        "condition": "Not released for ABAP Cloud",
        "action": "WARN: '{OBJECT}' is not released for ABAP Cloud (C1). Cannot use in BTP ABAP Environment."
      },
      {
        "condition": "Release dependency",
        "action": "WARN: '{OBJECT}' requires minimum release {RELEASE}. Verify target system compatibility."
      }
    ],
    "hallucinationIndicators": [
      "Object name follows SAP patterns but cannot be found",
      "Object documented only in user forums, not official sources",
      "Object type/name combination is invalid",
      "Similar-sounding objects exist (possible name confusion)",
      "Object was only mentioned in training data context"
    ]
  },
  "variables": [
    {"name": "{OBJECT_NAME}", "description": "Name of repository object", "required": true},
    {"name": "{OBJECT_TYPE}", "description": "Type (TABL, CLAS, INTF, FUGR, etc.)", "required": false},
    {"name": "{TARGET_ENVIRONMENT}", "description": "Target environment (standard, cloud)", "required": false},
    {"name": "{TARGET_RELEASE}", "description": "Target SAP release version", "required": false}
  ]
}
