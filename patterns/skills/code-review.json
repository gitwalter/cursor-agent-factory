{
  "metadata": {
    "patternId": "code-review",
    "patternName": "Code Review Skill",
    "category": "workflow",
    "stackAgnostic": true,
    "description": "Structured code review process covering quality, performance, security, and maintainability",
    "composable": true
  },
  "frontmatter": {
    "name": "code-review",
    "description": "Comprehensive code review skill for quality assurance",
    "type": "skill",
    "skills": ["grounding", "security-audit"],
    "knowledge": ["design-patterns.json", "security-checklist.json"]
  },
  "sections": {
    "title": "Code Review Skill",
    "introduction": "Performs comprehensive code review covering correctness, style, performance, security, and maintainability. Generates actionable feedback with severity ratings.",
    "whenToUse": [
      "Before merging pull requests",
      "After feature implementation",
      "When refactoring code",
      "For pair programming sessions",
      "During code audit"
    ],
    "process": [
      {
        "step": 1,
        "name": "Context Gathering",
        "description": "Understand the change context",
        "actions": [
          "Identify the purpose of the changes",
          "Review related tickets or specifications",
          "Understand the affected components",
          "Note the scope of changes"
        ]
      },
      {
        "step": 2,
        "name": "Correctness Review",
        "description": "Verify the code does what it should",
        "checks": [
          "Logic correctness and edge cases",
          "Error handling completeness",
          "Null/undefined handling",
          "Resource cleanup (connections, files, memory)",
          "Concurrency and race conditions"
        ],
        "severity": "critical"
      },
      {
        "step": 3,
        "name": "Style and Formatting",
        "description": "Check adherence to coding standards",
        "checks": [
          "Naming conventions (variables, functions, classes)",
          "Code formatting consistency",
          "File and folder organization",
          "Import ordering and grouping",
          "Comment quality and necessity"
        ],
        "referenceKnowledge": "Detect from .cursorrules or existing code",
        "severity": "low"
      },
      {
        "step": 4,
        "name": "Design Review",
        "description": "Evaluate architectural decisions",
        "checks": [
          "Single Responsibility Principle adherence",
          "Appropriate abstraction levels",
          "Design pattern usage",
          "Dependency management",
          "API design quality"
        ],
        "referenceKnowledge": "design-patterns.json",
        "severity": "medium"
      },
      {
        "step": 5,
        "name": "Performance Review",
        "description": "Identify performance concerns",
        "checks": [
          "Algorithm complexity (Big O)",
          "Database query efficiency (N+1 queries)",
          "Memory usage patterns",
          "Caching opportunities",
          "Unnecessary computations or allocations"
        ],
        "severity": "medium"
      },
      {
        "step": 6,
        "name": "Security Review",
        "description": "Check for security vulnerabilities",
        "skillsInvoked": ["security-audit"],
        "focusAreas": [
          "Input validation",
          "Authentication/Authorization",
          "Data exposure",
          "Injection vulnerabilities"
        ],
        "severity": "critical"
      },
      {
        "step": 7,
        "name": "Maintainability Review",
        "description": "Assess long-term maintainability",
        "checks": [
          "Code readability and clarity",
          "Documentation completeness",
          "Test coverage and quality",
          "Technical debt introduction",
          "Upgrade path considerations"
        ],
        "severity": "medium"
      },
      {
        "step": 8,
        "name": "Generate Review Report",
        "description": "Compile findings into structured feedback",
        "outputs": ["docs/code_review_report.md"],
        "format": {
          "sections": [
            "Summary",
            "Critical Issues",
            "Suggestions",
            "Positive Observations",
            "Questions for Author",
            "Approval Status"
          ]
        }
      }
    ],
    "feedbackFormat": {
      "issue": {
        "location": "File path and line number",
        "severity": "critical | high | medium | low",
        "category": "correctness | style | design | performance | security | maintainability",
        "description": "Clear explanation of the issue",
        "suggestion": "Specific improvement recommendation",
        "example": "Code example if helpful"
      }
    },
    "approvalCriteria": {
      "approve": "No critical or high issues, acceptable overall quality",
      "requestChanges": "Any critical issues, or multiple high issues",
      "comment": "Minor suggestions only, approve with comments"
    },
    "fallbackProcedures": [
      {"condition": "If style guide not specified", "action": "Detect from existing codebase patterns"},
      {"condition": "If context unclear", "action": "Ask for related ticket or specification"},
      {"condition": "If security assessment needed", "action": "Invoke security-audit skill"}
    ],
    "references": [
      "knowledge/design-patterns.json",
      "knowledge/security-checklist.json"
    ]
  },
  "variables": [
    {"name": "{STYLE_GUIDE}", "description": "Coding style guide to apply", "required": true},
    {"name": "{LANGUAGE}", "description": "Programming language", "required": true}
  ]
}
