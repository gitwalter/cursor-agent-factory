using TechTalk.SpecFlow;
using NUnit.Framework;

namespace {{NAMESPACE}}.Steps
{
    /// <summary>
    /// Step definitions for {{FEATURE_NAME}} feature.
    ///
    /// Generated by Cursor Agent Factory - BDD Skill
    /// Framework: SpecFlow (C#)
    /// </summary>
    [Binding]
    public class {{CLASS_NAME}}Steps
    {
        // Shared state between steps via ScenarioContext
        private readonly ScenarioContext _scenarioContext;

        public {{CLASS_NAME}}Steps(ScenarioContext scenarioContext)
        {
            _scenarioContext = scenarioContext;
        }

        // ====================================================================
        // Hooks
        // ====================================================================

        [BeforeScenario]
        public void SetUp()
        {
            // Reset state before each scenario
            _scenarioContext.Clear();
        }

        [AfterScenario]
        public void TearDown()
        {
            // Cleanup after each scenario
        }

        // ====================================================================
        // Given Steps - Setup and Preconditions
        // ====================================================================

        [Given(@"{{COMMON_PRECONDITION}}")]
        public void GivenCommonPrecondition()
        {
            /// <summary>
            /// Set up common preconditions for all scenarios.
            /// </summary>
            // TODO: Implement precondition setup
        }

        [Given(@"{{GIVEN_CLAUSE}}")]
        public void GivenMainSetup()
        {
            /// <summary>
            /// Set up the initial state for the scenario.
            /// </summary>
            // TODO: Implement given step
        }

        [Given(@"{{OUTLINE_GIVEN_CLAUSE}} with ""(.*)""")]
        public void GivenWithInput(string inputValue)
        {
            /// <summary>
            /// Set up state with parameterized input.
            /// </summary>
            _scenarioContext["inputValue"] = inputValue;
            // TODO: Implement parameterized setup
        }

        // ====================================================================
        // When Steps - Actions
        // ====================================================================

        [When(@"{{WHEN_CLAUSE}}")]
        public void WhenAction()
        {
            /// <summary>
            /// Execute the main action being tested.
            /// </summary>
            // TODO: Implement action
        }

        [When(@"{{OUTLINE_WHEN_CLAUSE}}")]
        public void WhenOutlineAction()
        {
            /// <summary>
            /// Execute action for scenario outline.
            /// </summary>
            var inputValue = _scenarioContext.Get<string>("inputValue");
            // TODO: Implement outline action using inputValue
        }

        // ====================================================================
        // Then Steps - Assertions
        // ====================================================================

        [Then(@"{{THEN_CLAUSE}}")]
        public void ThenVerify()
        {
            /// <summary>
            /// Verify the expected outcome.
            /// </summary>
            // TODO: Implement assertion
            Assert.IsTrue(true, "Expected outcome not met");
        }

        [Then(@"{{OUTLINE_THEN_CLAUSE}} should be ""(.*)""")]
        public void ThenVerifyResult(string expectedResult)
        {
            /// <summary>
            /// Verify parameterized expected result.
            /// </summary>
            var result = _scenarioContext.ContainsKey("result") 
                ? _scenarioContext.Get<string>("result") 
                : null;
            Assert.AreEqual(expectedResult, result, 
                $"Expected {expectedResult}, got {result}");
        }

        [Then(@"an appropriate error message should be displayed")]
        public void ThenErrorMessage()
        {
            /// <summary>
            /// Verify that an error message is displayed.
            /// </summary>
            Assert.IsTrue(_scenarioContext.ContainsKey("errorMessage"), 
                "Expected error message but none was displayed");
            var errorMessage = _scenarioContext.Get<string>("errorMessage");
            Assert.IsNotEmpty(errorMessage, "Error message should not be empty");
        }

        // ====================================================================
        // Shared/Reusable Steps
        // ====================================================================

        [Given(@"I wait for (\d+) seconds")]
        [When(@"I wait for (\d+) seconds")]
        public void WaitForSeconds(int seconds)
        {
            /// <summary>
            /// Wait for specified duration (use sparingly).
            /// </summary>
            System.Threading.Thread.Sleep(seconds * 1000);
        }

        [Given(@"I log ""(.*)""")]
        [When(@"I log ""(.*)""")]
        public void LogMessage(string message)
        {
            /// <summary>
            /// Log a debug message during scenario execution.
            /// </summary>
            Console.WriteLine($"[BDD LOG] {message}");
        }
    }
}
